<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tox Eran Bd</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary-color: #3B82F6;
            --secondary-color: #10B981;
            --background-start-color: #BFDBFE;
            --background-end-color: #A5F3FC;
            --card-bg-color: rgba(255, 255, 255, 0.45);
            --text-color: #1F2937;
            --light-text-color: #ffffff;
            --border-color: rgba(255, 255, 255, 0.6);
            --danger-color: #EF4444;
            --warning-color: #F59E0B;
            --font-family: 'Poppins', sans-serif;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: var(--font-family);
            background: linear-gradient(135deg, var(--background-start-color), var(--background-end-color));
            background-attachment: fixed;
            color: var(--text-color);
            -webkit-tap-highlight-color: transparent;
            overflow-x: hidden;
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
            padding: 15px;
        }

        .hidden { 
            display: none !important; 
        }

        .card {
            background: var(--card-bg-color);
            padding: 20px;
            margin-top: 20px;
            border-radius: 20px;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1.5px solid var(--border-color);
        }

        .card h3 {
            margin-top: 0;
            color: var(--text-color);
            font-weight: 600;
        }

        .btn {
            display: block;
            width: 100%;
            padding: 14px;
            margin-top: 10px;
            border: none;
            border-radius: 12px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            text-align: center;
            transition: transform 0.2s, box-shadow 0.2s;
            color: var(--light-text-color);
        }

        .btn:active {
            transform: scale(0.97);
        }

        .btn-primary {
            background: linear-gradient(90deg, var(--primary-color), #60A5FA);
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }
        
        .btn-secondary {
            background: linear-gradient(90deg, var(--secondary-color), #34D399);
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        }
        
        .btn-info {
            background: linear-gradient(90deg, var(--warning-color), #FBBF24);
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);
        }

        .header {
            color: var(--text-color);
            padding: 20px 0;
            text-align: left;
        }
        
        .header p {
            margin: 0; 
            font-size: 1.2em; 
            font-weight: 500;
        }
        
        .wallet-balance {
            font-size: 2.5em; 
            font-weight: 700; 
            margin-top: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        #onboarding-screen {
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%;
            background: linear-gradient(135deg, var(--background-start-color), var(--background-end-color));
            display: flex; 
            justify-content: center; 
            align-items: center; 
            z-index: 1000;
        }
        
        #onboarding-box {
            background: var(--card-bg-color);
            padding: 30px; 
            border-radius: 20px; 
            text-align: center; 
            width: 90%; 
            max-width: 380px;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
            backdrop-filter: blur(12px); 
            -webkit-backdrop-filter: blur(12px);
            border: 1.5px solid var(--border-color);
        }
        
        #onboarding-box h2 { 
            margin-top: 0; 
            color: var(--text-color); 
            font-weight: 600; 
        }
        
        #onboarding-box input {
            width: 100%; 
            padding: 14px; 
            margin-bottom: 15px;
            border: 1px solid var(--border-color); 
            border-radius: 12px; 
            font-size: 1em;
            background: rgba(255, 255, 255, 0.5); 
            font-family: var(--font-family);
        }
        
        #onboarding-box button {
            width: 100%; 
            padding: 14px; 
            background: var(--primary-color);
            color: var(--light-text-color); 
            border: none; 
            border-radius: 12px; 
            cursor: pointer;
            font-size: 1.1em; 
            font-weight: 600;
        }

        input[type="text"], input[type="number"], input[type="file"], select {
            width: 100%; 
            padding: 14px; 
            margin-bottom: 10px;
            border: 1px solid var(--border-color); 
            border-radius: 12px;
            font-size: 1em; 
            font-family: var(--font-family);
            background-color: rgba(255, 255, 255, 0.5);
            color: var(--text-color);
        }
        
        input::placeholder { 
            color: #6B7280; 
        }

        nav {
            position: fixed; 
            bottom: 15px; 
            left: 50%;
            transform: translateX(-50%);
            width: 95%; 
            max-width: 480px;
            background: rgba(255, 255, 255, 0.6);
            display: flex; 
            justify-content: space-around;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
            backdrop-filter: blur(15px); 
            -webkit-backdrop-filter: blur(15px);
            border: 1.5px solid rgba(255, 255, 255, 0.7);
            border-radius: 50px;
            z-index: 100;
            padding: 5px 0;
        }
        
        nav button {
            padding: 10px 5px; 
            border: none; 
            background: none; 
            cursor: pointer;
            flex-grow: 1; 
            font-size: 0.8em; 
            color: #6B7280;
            transition: color 0.3s, transform 0.2s;
            font-weight: 500;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 3px;
        }
        
        nav button:active { 
            transform: scale(0.9); 
        }
        
        nav button.active { 
            color: var(--primary-color); 
            font-weight: 700; 
        }
        
        .page { 
            padding-bottom: 100px;
        }

        .wheel-container { 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            margin: 25px 0; 
            position: relative; 
        }
        
        #wheel {
            width: 250px; 
            height: 250px;
            background-image: conic-gradient(
                #60A5FA 0% 12.5%, 
                #34D399 12.5% 25%, 
                #FBBF24 25% 37.5%, 
                #F87171 37.5% 50%, 
                #A78BFA 50% 62.5%, 
                #EC4899 62.5% 75%, 
                #22D3EE 75% 87.5%, 
                #4ADE80 87.5% 100%
            );
            border: 5px solid #fff; 
            border-radius: 50%;
            transition: transform 4s cubic-bezier(0.25, 0.1, 0.25, 1);
            box-shadow: 0 0 25px rgba(0,0,0,0.1);
        }
        
        .pointer {
            width: 0; 
            height: 0; 
            border-left: 18px solid transparent;
            border-right: 18px solid transparent; 
            border-top: 36px solid var(--danger-color);
            position: absolute; 
            top: -10px; 
            left: 50%;
            transform: translateX(-50%); 
            z-index: 10;
        }

        .quiz-container {
            text-align: center;
        }
        
        .quiz-question {
            font-size: 1.2em;
            margin-bottom: 20px;
            font-weight: 600;
        }
        
        .quiz-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .quiz-option {
            padding: 15px;
            background: var(--card-bg-color);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .quiz-option:hover {
            background: rgba(255, 255, 255, 0.7);
        }
        
        .quiz-option.correct {
            background: var(--secondary-color);
            color: white;
        }
        
        .quiz-option.wrong {
            background: var(--danger-color);
            color: white;
        }
        
        #quiz-result {
            margin-top: 20px;
            font-weight: 600;
            font-size: 1.1em;
        }
        
        #next-question-btn {
            margin-top: 20px;
        }

        #ad-popup {
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%;
            background: rgba(0,0,0,0.5); 
            z-index: 2000;
            display: flex; 
            justify-content: center; 
            align-items: center;
            backdrop-filter: blur(8px); 
            -webkit-backdrop-filter: blur(8px);
        }
        
        #ad-popup-box {
            background: var(--card-bg-color); 
            padding: 20px; 
            border-radius: 20px; 
            text-align: center;
            border: 1.5px solid var(--border-color);
        }
        
        #ad-popup-box #ad-placeholder { 
            min-width: 300px; 
            min-height: 250px; 
            background: #eee; 
            border-radius: 12px; 
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        #close-ad-btn {
            margin-top: 15px; 
            padding: 10px 20px; 
            background: var(--danger-color);
            color: var(--light-text-color); 
            border: none; 
            border-radius: 10px; 
            font-weight: 600;
        }

        #tap-card-popup {
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%;
            background: rgba(0,0,0,0.5); 
            z-index: 2000;
            display: flex; 
            justify-content: center; 
            align-items: center;
            backdrop-filter: blur(8px); 
            -webkit-backdrop-filter: blur(8px);
        }
        
        #tap-card-box {
            background: var(--card-bg-color); 
            padding: 20px; 
            border-radius: 20px; 
            text-align: center;
            border: 1.5px solid var(--border-color);
            width: 90%;
            max-width: 400px;
        }
        
        #close-tap-card-btn {
            margin-top: 15px; 
            padding: 10px 20px; 
            background: var(--danger-color);
            color: var(--light-text-color); 
            border: none; 
            border-radius: 10px; 
            font-weight: 600;
        }

        #wrong-answer-popup {
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%;
            background: rgba(0,0,0,0.5); 
            z-index: 2000;
            display: flex; 
            justify-content: center; 
            align-items: center;
            backdrop-filter: blur(8px); 
            -webkit-backdrop-filter: blur(8px);
        }
        
        #wrong-answer-box {
            background: var(--card-bg-color); 
            padding: 20px; 
            border-radius: 20px; 
            text-align: center;
            border: 1.5px solid var(--border-color);
            width: 90%;
            max-width: 400px;
        }
        
        #wrong-answer-timer {
            font-size: 1.5em;
            font-weight: 700;
            color: var(--danger-color);
            margin: 15px 0;
        }

        #toast {
            position: fixed; 
            bottom: 100px; 
            left: 50%; 
            transform: translateX(-50%);
            background-color: rgba(20, 20, 20, 0.85);
            color: white; 
            padding: 12px 25px;
            border-radius: 50px; 
            font-size: 0.9em; 
            z-index: 3000;
            visibility: hidden; 
            opacity: 0;
            transition: opacity 0.5s, visibility 0.5s;
            backdrop-filter: blur(5px);
        }
        
        #toast.show { 
            visibility: visible; 
            opacity: 1; 
        }

        .loading {
            text-align: center;
            padding: 20px;
        }
        
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top: 4px solid var(--primary-color);
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .limit-info {
            font-size: 0.85em;
            color: #6B7280;
            margin-top: 5px;
            text-align: center;
        }

        .app-install-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .app-install-item:last-child {
            border-bottom: none;
        }

        .app-install-info {
            flex: 1;
        }

        .app-install-name {
            font-weight: 600;
        }

        .app-install-reward {
            color: var(--secondary-color);
            font-size: 0.9em;
        }

        .app-install-btn {
            padding: 8px 15px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
        }

        .app-install-btn:disabled {
            background: #9CA3AF;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <div id="toast"></div>

    <div id="onboarding-screen">
        <div id="onboarding-box">
            <h2>‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ!</h2>
            <p>‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø ‡¶¶‡¶ø‡¶®‡•§</p>
            <input type="text" id="userName" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶¶‡¶ø‡¶®" required>
            <input type="text" id="userUpi" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡¶ø‡¶ï‡¶æ‡¶∂/‡¶®‡¶ó‡¶¶ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶¶‡¶ø‡¶®" required>
            <button id="saveUser">‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        </div>
    </div>

    <div id="ad-popup" class="hidden">
        <div id="ad-popup-box">
            <h4>‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶®</h4>
            <div id="ad-placeholder">
                <script type="text/javascript">
                    atOptions = {
                        'key' : '1e07401901ac4fbae023c7bd388874ed',
                        'format' : 'iframe',
                        'height' : 250,
                        'width' : 300,
                        'params' : {}
                    };
                </script>
                <script type="text/javascript" src="//www.highperformanceformat.com/1e07401901ac4fbae023c7bd388874ed/invoke.js"></script>
            </div>
            <button id="close-ad-btn">‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        </div>
    </div>
    
    <div id="tap-card-popup" class="hidden">
        <div id="tap-card-box">
            <h4>‡¶ü‡ßç‡¶Ø‡¶æ‡¶™ ‡¶ï‡¶æ‡¶∞‡ßç‡¶°</h4>
            <div id="tap-card-ad-container" style="display: flex; justify-content: center; align-items: center; min-height: 250px; margin-bottom: 15px;">
                <script type="text/javascript">
                    atOptions = {
                        'key' : '1e07401901ac4fbae023c7bd388874ed',
                        'format' : 'iframe',
                        'height' : 250,
                        'width' : 300,
                        'params' : {}
                    };
                </script>
                <script type="text/javascript" src="//www.highperformanceformat.com/1e07401901ac4fbae023c7bd388874ed/invoke.js"></script>
            </div>
            <button id="close-tap-card-btn">‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        </div>
    </div>

    <div id="wrong-answer-popup" class="hidden">
        <div id="wrong-answer-box">
            <h4>‡¶≠‡ßÅ‡¶≤ ‡¶â‡¶§‡ßç‡¶§‡¶∞!</h4>
            <p>‡¶Ü‡¶™‡¶®‡¶ø ‡¶≠‡ßÅ‡¶≤ ‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡¶®‡•§ ‡¶™‡ßÅ‡¶®‡¶∞‡¶æ‡¶Ø‡¶º ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶®‡¶ø‡¶ö‡ßá‡¶∞ ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶®‡¶ü‡¶ø ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®‡•§</p>
            <div id="wrong-answer-ad" style="display: flex; justify-content: center; align-items: center; min-height: 250px; margin-bottom: 15px;">
                <script type="text/javascript">
                    atOptions = {
                        'key' : '1e07401901ac4fbae023c7bd388874ed',
                        'format' : 'iframe',
                        'height' : 250,
                        'width' : 300,
                        'params' : {}
                    };
                </script>
                <script type="text/javascript" src="//www.highperformanceformat.com/1e07401901ac4fbae023c7bd388874ed/invoke.js"></script>
            </div>
            <div id="wrong-answer-timer">‡ßß‡ß´</div>
            <p>‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶™‡¶∞ ‡¶∏‡ßç‡¶¨‡¶Ø‡¶º‡¶Ç‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º‡¶≠‡¶æ‡¶¨‡ßá ‡¶∞‡¶ø‡¶°‡¶æ‡¶á‡¶∞‡ßá‡¶ï‡ßç‡¶ü ‡¶π‡¶¨‡ßá</p>
        </div>
    </div>

    <div class="container">
        <div id="home-page" class="page">
            <div class="header">
                <p>‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏</p>
                <div class="wallet-balance">
                    <span id="coin-balance">0</span> ü™ô
                </div>
            </div>

            <div class="card">
                <h3>‡¶ü‡ßç‡¶Ø‡¶æ‡¶™ ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶Ø‡¶º</h3>
                <p>‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ü‡¶ø ‡¶ü‡ßç‡¶Ø‡¶æ‡¶™‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶ï‡¶æ‡¶∞‡ßç‡¶° ‡¶ì‡¶™‡ßá‡¶® ‡¶π‡¶¨‡ßá ‡¶è‡¶¨‡¶Ç ‡¶Ö‡¶ü‡ßã‡¶™‡ßç‡¶≤‡ßá ‡¶π‡¶¨‡ßá!</p>
                <button id="tap-btn" class="btn btn-primary">‡¶ü‡ßç‡¶Ø‡¶æ‡¶™ ‡¶ï‡¶∞‡ßÅ‡¶® (<span id="tap-count">0</span>/<span id="tap-limit">5</span>)</button>
                <div class="limit-info">‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶≤‡¶ø‡¶Æ‡¶ø‡¶ü: <span id="tap-limit-info">5</span> ‡¶ü‡ßç‡¶Ø‡¶æ‡¶™</div>
            </div>
            
            <div class="card">
                <h3>‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶¶‡ßá‡¶ñ‡ßá ‡¶Ü‡¶Ø‡¶º</h3>
                <p>‡¶è‡¶ï‡¶ü‡¶ø ‡¶õ‡ßã‡¶ü ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡ßá ‡¶ï‡¶Ø‡¶º‡ßá‡¶® ‡¶ú‡¶ø‡¶§‡ßÅ‡¶®‡•§</p>
                <button id="watch-ad-btn" class="btn btn-secondary">‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶® (<span id="ad-count">0</span>/<span id="ad-limit">5</span>)</button>
                <div class="limit-info">‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶≤‡¶ø‡¶Æ‡¶ø‡¶ü: <span id="ad-limit-info">5</span> ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶®</div>
            </div>

            <div class="card">
                <h3>‡¶∏‡ßç‡¶™‡¶ø‡¶® ‡¶π‡ßÅ‡¶á‡¶≤</h3>
                <div class="wheel-container">
                    <div class="pointer"></div>
                    <div id="wheel"></div>
                </div>
                <button id="spin-btn" class="btn btn-info">‡¶è‡¶ñ‡¶®‡¶á ‡¶∏‡ßç‡¶™‡¶ø‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®! (<span id="spin-count">0</span>/<span id="spin-limit">3</span>)</button>
                <div class="limit-info">‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶≤‡¶ø‡¶Æ‡¶ø‡¶ü: <span id="spin-limit-info">3</span> ‡¶∏‡ßç‡¶™‡¶ø‡¶®</div>
            </div>
        </div>

        <div id="game-page" class="page hidden">
            <div class="card">
                <h3>‡¶ï‡ßÅ‡¶á‡¶ú ‡¶ó‡ßá‡¶Æ</h3>
                <div class="quiz-container">
                    <div class="quiz-question" id="quiz-question">‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</div>
                    <div class="quiz-options" id="quiz-options">
                        </div>
                    <div id="quiz-result"></div>
                    <button id="next-question-btn" class="btn btn-primary hidden">‡¶™‡¶∞‡¶¨‡¶∞‡ßç‡¶§‡ßÄ ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®</button>
                </div>
            </div>
        </div>

        <div id="wallet-page" class="page hidden">
            <div class="card">
                <h3>‡¶ï‡¶Ø‡¶º‡ßá‡¶® ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®</h3>
                <input type="number" id="withdraw-coins" placeholder="‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ï‡¶Ø‡¶º‡ßá‡¶® ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®">
                <select id="withdraw-method">
                    <option value="">‡¶™‡¶¶‡ßç‡¶ß‡¶§‡¶ø ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</option>
                    <option value="bkash">‡¶¨‡¶ø‡¶ï‡¶æ‡¶∂</option>
                    <option value="nagad">‡¶®‡¶ó‡¶¶</option>
                </select>
                <p>‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø: ‡ß≥<span id="withdraw-value">0.00</span></p>
                <p class="min-withdrawal-note" style="color: var(--danger-color); font-size: 0.9em;">‡¶∏‡¶∞‡ßç‡¶¨‡¶®‡¶ø‡¶Æ‡ßç‡¶® ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®: ‡ß≥‡ßß‡ß¶‡ß¶</p>
                <button id="withdraw-btn" class="btn btn-primary">‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®‡ßá‡¶∞ ‡¶Ö‡¶®‡ßÅ‡¶∞‡ßã‡¶ß ‡¶™‡¶æ‡¶†‡¶æ‡¶®</button>
            </div>
            <div class="card">
                <h3>‡¶ü‡¶æ‡¶ï‡¶æ ‡¶ú‡¶Æ‡¶æ ‡¶¶‡¶ø‡¶®</h3>
                <p>‡¶è‡¶á ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞‡ßá ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶™‡¶æ‡¶†‡¶æ‡¶®: <b id="admin-upi">01xxxxxxxxx (‡¶¨‡¶ø‡¶ï‡¶æ‡¶∂/‡¶®‡¶ó‡¶¶)</b></p>
                <p>‡¶ü‡¶æ‡¶ï‡¶æ ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã‡¶∞ ‡¶™‡¶∞, ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü‡ßá‡¶∞ ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶®‡¶∂‡¶ü ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</p>
                <input type="file" id="payment-screenshot" accept="image/*">
                <input type="number" id="deposit-amount" placeholder="‡¶ï‡¶§ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶ú‡¶Æ‡¶æ ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡¶® (‡ß≥)">
                <button id="deposit-btn" class="btn btn-secondary">‡¶∞‡¶ø‡¶≠‡¶ø‡¶â‡¶Ø‡¶º‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ú‡¶Æ‡¶æ ‡¶¶‡¶ø‡¶®</button>
            </div>
        </div>
        
        <div id="promo-page" class="page hidden">
            <div class="card">
                <h3>‡¶Æ‡¶ø‡¶®‡¶ø ‡¶ó‡ßá‡¶Æ ‡¶™‡ßç‡¶∞‡ßã‡¶Æ‡ßã‡¶∂‡¶®</h3>
                <div id="promo-games-list" class="loading">
                    <div class="spinner"></div>
                    <p>‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>
                </div>
            </div>
            <div class="card">
                <h3>‡¶´‡¶≤‡ßã ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶Ø‡¶º</h3>
                <div id="social-tasks-list" class="loading">
                    <div class="spinner"></div>
                    <p>‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>
                </div>
            </div>
        </div>

        <div id="profile-page" class="page hidden">
            <div class="card">
                <h3>‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤</h3>
                <label>‡¶®‡¶æ‡¶Æ:</label>
                <input type="text" id="profileName">
                <label>‡¶¨‡¶ø‡¶ï‡¶æ‡¶∂/‡¶®‡¶ó‡¶¶ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞:</label>
                <input type="text" id="profileUpi">
                <button id="update-profile-btn" class="btn btn-primary">‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            </div>
             <div class="card">
                <h3>‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶®‡ßá‡¶∞ ‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏</h3>
                <h4>‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®</h4>
                <ul id="withdrawal-history"></ul>
                <h4>‡¶ú‡¶Æ‡¶æ</h4>
                <ul id="deposit-history"></ul>
            </div>
            <div class="card">
                <h3>‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶Ø‡¶º</h3>
                <p>‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶ï‡ßã‡¶°:</p>
                <b id="referral-code" style="font-size: 1.2em; color: var(--secondary-color);"></b>
                <button id="share-whatsapp-btn" class="btn btn-info">WhatsApp-‡¶è ‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            </div>
            <div class="card">
                <h3>‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡¶∏ ‡¶á‡¶®‡ßç‡¶∏‡¶ü‡¶≤ ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
                <div id="app-install-list" class="loading">
                    <div class="spinner"></div>
                    <p>‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>
                </div>
            </div>
        </div>
    </div>
    
    <nav>
        <button data-page="home-page" class="active">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                <polyline points="9 22 9 12 15 12 15 22"></polyline>
            </svg>
            ‡¶π‡ßã‡¶Æ
        </button>
        <button data-page="game-page">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="6" y1="12" x2="10" y2="12"></line>
                <line x1="8" y1="10" x2="8" y2="14"></line>
                <line x1="15" y1="13" x2="15" y2="11"></line>
                <line x1="18" y1="15" x2="18" y2="9"></line>
                <rect x="3" y="5" width="18" height="14" rx="2"></rect>
            </svg>
            ‡¶ó‡ßá‡¶Æ
        </button>
        <button data-page="wallet-page">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M21 12V7H5a2 2 0 0 1 0-4h14v4"></path>
                <path d="M3 5v14a2 2 0 0 0 2 2h16v-5"></path>
                <path d="M18 12a2 2 0 0 0 0 4h4v-4Z"></path>
            </svg>
            ‡¶ì‡¶Ø‡¶º‡¶æ‡¶≤‡ßá‡¶ü
        </button>
        <button data-page="promo-page">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon>
            </svg>
            ‡¶™‡ßç‡¶∞‡ßã‡¶Æ‡ßã
        </button>
        <button data-page="profile-page">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"></path>
                <circle cx="12" cy="7" r="4"></circle>
            </svg>
            ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤
        </button>
    </nav>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    
    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyB6hl7dLmvDiXowSVt_O7E5cw2StgbfTwI",
            authDomain: "taka-eran-d1890.firebaseapp.com",
            databaseURL: "https://taka-eran-d1890-default-rtdb.firebaseio.com",
            projectId: "taka-eran-d1890",
            storageBucket: "taka-eran-d1890.firebasestorage.app",
            messagingSenderId: "551623752909",
            appId: "1:551623752909:web:14de745a292112f2d83d84",
            measurementId: "G-RNNVS8M247"
        };
        
        // App State
        let userData = {};
        let userId = '';
        let tapCount = 0;
        let adCount = 0;
        let spinCount = 0;
        let appSettings = {};
        let tapSettings = {};
        let adSettings = {};
        let spinSettings = {};
        let currentQuestionIndex = 0;
        let quizQuestions = [];
        let isFirebaseInitialized = false;

        // Quiz Data
        const quizData = [
            {
                question: "‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂‡ßá‡¶∞ ‡¶ú‡¶æ‡¶§‡ßÄ‡¶Ø‡¶º ‡¶´‡ßÅ‡¶≤ ‡¶ï‡ßã‡¶®‡¶ü‡¶ø?",
                options: ["‡¶ó‡ßã‡¶≤‡¶æ‡¶™", "‡¶∂‡¶æ‡¶™‡¶≤‡¶æ", "‡¶ó‡¶æ‡¶Å‡¶¶‡¶æ", "‡¶ï‡¶Æ‡¶≤"],
                correctAnswer: 1
            },
            {
                question: "‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂‡ßá‡¶∞ ‡¶∏‡ßç‡¶¨‡¶æ‡¶ß‡ßÄ‡¶®‡¶§‡¶æ ‡¶¶‡¶ø‡¶¨‡¶∏ ‡¶ï‡¶¨‡ßá?",
                options: ["‡ß®‡ß¨ ‡¶Æ‡¶æ‡¶∞‡ßç‡¶ö", "‡ßß‡ß¨ ‡¶°‡¶ø‡¶∏‡ßá‡¶Æ‡ßç‡¶¨‡¶∞", "‡ß®‡ßß ‡¶´‡ßá‡¶¨‡ßç‡¶∞‡ßÅ‡¶Ø‡¶º‡¶æ‡¶∞‡¶ø", "‡ßß‡ß´ ‡¶Ü‡¶ó‡¶∏‡ßç‡¶ü"],
                correctAnswer: 0
            },
            {
                question: "‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂‡ßá‡¶∞ ‡¶ú‡¶æ‡¶§‡ßÄ‡¶Ø‡¶º ‡¶™‡¶æ‡¶ñ‡¶ø ‡¶ï‡ßã‡¶®‡¶ü‡¶ø?",
                options: ["‡¶Æ‡¶Ø‡¶º‡¶®‡¶æ", "‡¶ï‡¶æ‡¶ï", "‡¶¶‡ßã‡¶Ø‡¶º‡ßá‡¶≤", "‡¶ö‡¶ø‡¶≤"],
                correctAnswer: 2
            },
            {
                question: "‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂‡ßá‡¶∞ ‡¶∞‡¶æ‡¶ú‡¶ß‡¶æ‡¶®‡ßÄ‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶ï‡ßÄ?",
                options: ["‡¶ö‡¶ü‡ßç‡¶ü‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ", "‡¶¢‡¶æ‡¶ï‡¶æ", "‡¶ñ‡ßÅ‡¶≤‡¶®‡¶æ", "‡¶∞‡¶æ‡¶ú‡¶∂‡¶æ‡¶π‡ßÄ"],
                correctAnswer: 1
            },
            {
                question: "‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂‡ßá‡¶∞ ‡¶ú‡¶æ‡¶§‡ßÄ‡¶Ø‡¶º ‡¶´‡¶≤ ‡¶ï‡ßã‡¶®‡¶ü‡¶ø?",
                options: ["‡¶Ü‡¶Æ", "‡¶ï‡¶æ‡¶Å‡¶†‡¶æ‡¶≤", "‡¶≤‡¶ø‡¶ö‡ßÅ", "‡¶ï‡¶≤‡¶æ"],
                correctAnswer: 1
            }
        ];

        // Toast Notification
        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => { 
                toast.classList.remove('show'); 
            }, 3000);
        }

        // Ad Logic
        const adPopup = document.getElementById('ad-popup');
        let adRewardCallback = null;
        
        function showAd(rewardCallback) {
            adPopup.classList.remove('hidden');
            adRewardCallback = rewardCallback;
        }
        
        document.getElementById('close-ad-btn').addEventListener('click', () => {
            adPopup.classList.add('hidden');
            if (adRewardCallback) {
                adRewardCallback();
                adRewardCallback = null;
            }
        });

        // Tap Card Logic
        const tapCardPopup = document.getElementById('tap-card-popup');
        document.getElementById('close-tap-card-btn').addEventListener('click', () => {
            tapCardPopup.classList.add('hidden');
        });

        // Wrong Answer Popup Logic
        const wrongAnswerPopup = document.getElementById('wrong-answer-popup');
        let wrongAnswerTimer = null;
        
        function showWrongAnswerPopup() {
            wrongAnswerPopup.classList.remove('hidden');
            
            // Start 15 second timer
            let seconds = 15;
            const timerElement = document.getElementById('wrong-answer-timer');
            
            wrongAnswerTimer = setInterval(() => {
                seconds--;
                timerElement.textContent = seconds;
                
                if (seconds <= 0) {
                    clearInterval(wrongAnswerTimer);
                    // Redirect to admin-set link
                    if (appSettings.wrongAnswerRedirectUrl) {
                        window.open(appSettings.wrongAnswerRedirectUrl, '_blank');
                    }
                    wrongAnswerPopup.classList.add('hidden');
                    // Allow user to play again
                    loadNextQuestion();
                }
            }, 1000);
        }

        // Initialize Firebase
        function initializeFirebase() {
            try {
                if (typeof firebase !== 'undefined') {
                    firebase.initializeApp(firebaseConfig);
                    isFirebaseInitialized = true;
                    console.log("Firebase initialized successfully");
                    return true;
                } else {
                    console.error("Firebase SDK not loaded");
                    return false;
                }
            } catch (error) {
                console.error("Firebase initialization error:", error);
                return false;
            }
        }

        // App Initialization
        function initializeApp() {
            userId = localStorage.getItem('earningAppUserId');
            
            if (userId) {
                document.getElementById('onboarding-screen').classList.add('hidden');
                
                // Initialize Firebase first
                if (initializeFirebase()) {
                    // Load essential features first
                    loadEssentialFeatures();
                    
                    // Load other features gradually
                    setTimeout(loadSecondaryFeatures, 1000);
                    setTimeout(loadTertiaryFeatures, 2000);
                } else {
                    showToast("‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡¶ü‡¶ø ‡¶Ö‡¶´‡¶≤‡¶æ‡¶á‡¶® ‡¶Æ‡ßã‡¶°‡ßá ‡¶ö‡¶≤‡¶õ‡ßá‡•§ ‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡¶®‡ßá‡¶ü ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§");
                    initializeOfflineMode();
                }
            }
        }

        // Load essential features first
        function loadEssentialFeatures() {
            listenToUserData();
            listenToAppSettings();
            initializeQuiz();
            loadAppInstallList();
            checkDailyLimits();
        }

        // Load secondary features
        function loadSecondaryFeatures() {
            listenToTapSettings();
            listenToAdSettings();
            listenToSpinSettings();
        }

        // Load tertiary features
        function loadTertiaryFeatures() {
            loadTransactionHistory();
            loadPromotions();
            loadSocialTasks();
        }

        // Offline mode initialization
        function initializeOfflineMode() {
            // Load user data from localStorage
            const savedUserData = localStorage.getItem('userData');
            if (savedUserData) {
                userData = JSON.parse(savedUserData);
                document.getElementById('coin-balance').innerText = Math.floor(userData.coins || 0);
                document.getElementById('profileName').value = userData.name || '';
                document.getElementById('profileUpi').value = userData.upi || '';
                document.getElementById('referral-code').innerText = userData.referralCode || 'N/A';
            }
            
            // Set default settings
            appSettings = {
                paymentNumber: '01xxxxxxxxx (‡¶¨‡¶ø‡¶ï‡¶æ‡¶∂)',
                conversionRate: 100,
                minWithdrawal: 50,
                wrongAnswerRedirectUrl: 'https://example.com'
            };
            
            document.getElementById('admin-upi').innerText = appSettings.paymentNumber;
            
            // Set default limits
            tapSettings = {
                dailyLimit: 5,
                coinsPerTap: 1
            };
            
            adSettings = {
                dailyLimit: 5,
                adReward: 5
            };
            
            spinSettings = {
                dailyLimit: 3,
                spinMaxReward: 10
            };
            
            updateLimitDisplay();
        }

        // Firebase Listeners
        function listenToUserData() {
            if (!isFirebaseInitialized || !userId) return;
            
            try {
                firebase.database().ref('users/' + userId).on('value', (snapshot) => {
                    userData = snapshot.val();
                    if (userData) {
                        document.getElementById('coin-balance').innerText = Math.floor(userData.coins || 0);
                        document.getElementById('profileName').value = userData.name;
                        document.getElementById('profileUpi').value = userData.upi;
                        document.getElementById('referral-code').innerText = userData.referralCode;
                        
                        // Save to localStorage for offline use
                        localStorage.setItem('userData', JSON.stringify(userData));
                    }
                });
            } catch (error) {
                console.error("Error listening to user data:", error);
            }
        }

        function listenToAppSettings() {
            if (!isFirebaseInitialized) return;
            
            try {
                firebase.database().ref('settings').on('value', snapshot => {
                    appSettings = snapshot.val() || {};
                    document.getElementById('admin-upi').innerText = appSettings.paymentNumber || '01xxxxxxxxx (‡¶¨‡¶ø‡¶ï‡¶æ‡¶∂)';
                    
                    document.getElementById('withdraw-coins').addEventListener('input', e => {
                       const value = e.target.value / (appSettings.conversionRate || 100);
                       document.getElementById('withdraw-value').innerText = value.toFixed(2);
                    });
                });
            } catch (error) {
                console.error("Error listening to app settings:", error);
            }
        }
        
        function listenToTapSettings() {
            if (!isFirebaseInitialized) return;
            
            try {
                firebase.database().ref('tapSettings').on('value', snapshot => {
                    tapSettings = snapshot.val() || {};
                    updateLimitDisplay();
                });
            } catch (error) {
                console.error("Error listening to tap settings:", error);
            }
        }
        
        function listenToAdSettings() {
            if (!isFirebaseInitialized) return;
            
            try {
                firebase.database().ref('adSettings').on('value', snapshot => {
                    adSettings = snapshot.val() || {};
                    updateLimitDisplay();
                });
            } catch (error) {
                console.error("Error listening to ad settings:", error);
            }
        }
        
        function listenToSpinSettings() {
            if (!isFirebaseInitialized) return;
            
            try {
                firebase.database().ref('spinSettings').on('value', snapshot => {
                    spinSettings = snapshot.val() || {};
                    updateLimitDisplay();
                });
            } catch (error) {
                console.error("Error listening to spin settings:", error);
            }
        }

        function updateCoins(amount) {
            if (!isFirebaseInitialized || !userId) {
                // Offline mode - update localStorage
                userData.coins = (userData.coins || 0) + amount;
                document.getElementById('coin-balance').innerText = Math.floor(userData.coins);
                localStorage.setItem('userData', JSON.stringify(userData));
                return Promise.resolve();
            }
            
            const userCoinsRef = firebase.database().ref('users/' + userId + '/coins');
            return userCoinsRef.transaction(currentCoins => (currentCoins || 0) + amount);
        }

        // Daily Limits Management
        function checkDailyLimits() {
            const today = new Date().toDateString();
            const limitsData = JSON.parse(localStorage.getItem('dailyLimits') || '{}');
            
            if (limitsData.date !== today) {
                // Reset daily counts
                tapCount = 0;
                adCount = 0;
                spinCount = 0;
                limitsData.date = today;
                limitsData.tapCount = 0;
                limitsData.adCount = 0;
                limitsData.spinCount = 0;
                localStorage.setItem('dailyLimits', JSON.stringify(limitsData));
            } else {
                tapCount = limitsData.tapCount || 0;
                adCount = limitsData.adCount || 0;
                spinCount = limitsData.spinCount || 0;
            }
            
            updateLimitDisplay();
        }

        function updateLimitDisplay() {
            document.getElementById('tap-count').innerText = tapCount;
            document.getElementById('tap-limit').innerText = tapSettings.dailyLimit || 5;
            document.getElementById('tap-limit-info').innerText = tapSettings.dailyLimit || 5;
            
            document.getElementById('ad-count').innerText = adCount;
            document.getElementById('ad-limit').innerText = adSettings.dailyLimit || 5;
            document.getElementById('ad-limit-info').innerText = adSettings.dailyLimit || 5;
            
            document.getElementById('spin-count').innerText = spinCount;
            document.getElementById('spin-limit').innerText = spinSettings.dailyLimit || 3;
            document.getElementById('spin-limit-info').innerText = spinSettings.dailyLimit || 3;
            
            // Disable buttons if limits reached
            document.getElementById('tap-btn').disabled = tapCount >= (tapSettings.dailyLimit || 5);
            document.getElementById('watch-ad-btn').disabled = adCount >= (adSettings.dailyLimit || 5);
            document.getElementById('spin-btn').disabled = spinCount >= (spinSettings.dailyLimit || 3);
        }

        function saveDailyCounts() {
            const limitsData = {
                date: new Date().toDateString(),
                tapCount: tapCount,
                adCount: adCount,
                spinCount: spinCount
            };
            localStorage.setItem('dailyLimits', JSON.stringify(limitsData));
        }

        // Earning Methods
        document.getElementById('tap-btn').addEventListener('click', () => {
            if (tapCount >= (tapSettings.dailyLimit || 5)) {
                showToast("‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶ü‡ßç‡¶Ø‡¶æ‡¶™ ‡¶≤‡¶ø‡¶Æ‡¶ø‡¶ü ‡¶∂‡ßá‡¶∑ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶Ü‡¶ó‡¶æ‡¶Æ‡ßÄ‡¶ï‡¶æ‡¶≤ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§");
                return;
            }
            
            tapCount++;
            document.getElementById('tap-count').innerText = tapCount;
            saveDailyCounts();
            
            // Show tap card popup
            tapCardPopup.classList.remove('hidden');
            
            const coinsPerTap = tapSettings.coinsPerTap || 1;
            updateCoins(coinsPerTap);
            showToast(`‡¶Ü‡¶™‡¶®‡¶ø ${coinsPerTap} ‡¶ï‡¶Ø‡¶º‡ßá‡¶® ‡¶ú‡¶ø‡¶§‡ßá‡¶õ‡ßá‡¶®!`);
            
            // Check if limit reached
            if (tapCount >= (tapSettings.dailyLimit || 5)) {
                document.getElementById('tap-btn').disabled = true;
                showToast("‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶ü‡ßç‡¶Ø‡¶æ‡¶™ ‡¶≤‡¶ø‡¶Æ‡¶ø‡¶ü ‡¶∂‡ßá‡¶∑ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶Ü‡¶ó‡¶æ‡¶Æ‡ßÄ‡¶ï‡¶æ‡¶≤ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§");
            }
        });

        document.getElementById('watch-ad-btn').addEventListener('click', () => {
            if (adCount >= (adSettings.dailyLimit || 5)) {
                showToast("‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶≤‡¶ø‡¶Æ‡¶ø‡¶ü ‡¶∂‡ßá‡¶∑ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶Ü‡¶ó‡¶æ‡¶Æ‡ßÄ‡¶ï‡¶æ‡¶≤ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§");
                return;
            }
            
            showAd(() => {
                adCount++;
                document.getElementById('ad-count').innerText = adCount;
                saveDailyCounts();
                
                const reward = adSettings.adReward || 5;
                updateCoins(reward).then(() => {
                    showToast(`‡¶Ü‡¶™‡¶®‡¶ø ${reward} ‡¶ï‡¶Ø‡¶º‡ßá‡¶® ‡¶ú‡¶ø‡¶§‡ßá‡¶õ‡ßá‡¶®!`);
                    
                    // Check if limit reached
                    if (adCount >= (adSettings.dailyLimit || 5)) {
                        document.getElementById('watch-ad-btn').disabled = true;
                        showToast("‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶≤‡¶ø‡¶Æ‡¶ø‡¶ü ‡¶∂‡ßá‡¶∑ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶Ü‡¶ó‡¶æ‡¶Æ‡ßÄ‡¶ï‡¶æ‡¶≤ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§");
                    }
                }).catch(err => showToast('‡¶ï‡¶Ø‡¶º‡ßá‡¶® ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø‡•§ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§'));
            });
        });

        document.getElementById('spin-btn').addEventListener('click', (e) => {
            const button = e.target;
            if (button.disabled) return;
            
            if (spinCount >= (spinSettings.dailyLimit || 3)) {
                showToast("‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶∏‡ßç‡¶™‡¶ø‡¶® ‡¶≤‡¶ø‡¶Æ‡¶ø‡¶ü ‡¶∂‡ßá‡¶∑ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶Ü‡¶ó‡¶æ‡¶Æ‡ßÄ‡¶ï‡¶æ‡¶≤ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§");
                return;
            }

            button.disabled = true;

            const wheel = document.getElementById('wheel');
            const degrees = Math.floor(Math.random() * 3000) + 1800;
            wheel.style.transform = `rotate(${degrees}deg)`;
            
            setTimeout(() => {
                spinCount++;
                document.getElementById('spin-count').innerText = spinCount;
                saveDailyCounts();
                
                const maxReward = spinSettings.spinMaxReward || 10;
                const randomCoins = Math.ceil(Math.random() * maxReward);
                updateCoins(randomCoins).then(() => {
                    showToast(`‡¶Ü‡¶™‡¶®‡¶ø ‡¶∏‡ßç‡¶™‡¶ø‡¶® ‡¶ï‡¶∞‡ßá ${randomCoins} ‡¶ï‡¶Ø‡¶º‡ßá‡¶® ‡¶ú‡¶ø‡¶§‡ßá‡¶õ‡ßá‡¶®!`);
                    
                    // Check if limit reached
                    if (spinCount >= (spinSettings.dailyLimit || 3)) {
                        button.disabled = true;
                        showToast("‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶∏‡ßç‡¶™‡¶ø‡¶® ‡¶≤‡¶ø‡¶Æ‡¶ø‡¶ü ‡¶∂‡ßá‡¶∑ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶Ü‡¶ó‡¶æ‡¶Æ‡ßÄ‡¶ï‡¶æ‡¶≤ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§");
                    } else {
                        button.disabled = false;
                    }
                }).catch(err => {
                    showToast('‡¶™‡ßÅ‡¶∞‡¶∏‡ßç‡¶ï‡¶æ‡¶∞ ‡¶∏‡¶Ç‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø‡•§ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
                    button.disabled = false;
                });
            }, 4500);
        });

        // App Install Feature
        function loadAppInstallList() {
            if (!isFirebaseInitialized) {
                document.getElementById('app-install-list').innerHTML = '<p>‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡¶®‡ßá‡¶ü ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶®‡ßá‡¶á‡•§ ‡¶™‡¶∞‡ßá ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</p>';
                return;
            }
            
            firebase.database().ref('appInstallTasks').on('value', s => {
                const list = document.getElementById('app-install-list');
                list.innerHTML = '';
                
                if (!s.exists()) {
                    list.innerHTML = '<p>‡¶ï‡ßã‡¶® ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡¶∏ ‡¶á‡¶®‡ßç‡¶∏‡¶ü‡¶≤ ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶®‡ßá‡¶á</p>';
                    return;
                }
                
                s.forEach(c => {
                    const app = c.val();
                    const appId = c.key;
                    const isInstalled = localStorage.getItem(`app_installed_${appId}`);
                    
                    const appItem = document.createElement('div');
                    appItem.className = 'app-install-item';
                    appItem.innerHTML = `
                        <div class="app-install-info">
                            <div class="app-install-name">${app.name}</div>
                            <div class="app-install-reward">‡¶™‡ßÅ‡¶∞‡¶∏‡ßç‡¶ï‡¶æ‡¶∞: ${app.reward} ‡¶ï‡¶Ø‡¶º‡ßá‡¶®</div>
                        </div>
                        <button class="app-install-btn" data-app-id="${appId}" data-reward="${app.reward}" data-url="${app.url}" ${isInstalled ? 'disabled' : ''}>
                            ${isInstalled ? '‡¶á‡¶®‡ßç‡¶∏‡¶ü‡¶≤‡¶°' : '‡¶á‡¶®‡ßç‡¶∏‡¶ü‡¶≤ ‡¶ï‡¶∞‡ßÅ‡¶®'}
                        </button>
                    `;
                    
                    list.appendChild(appItem);
                });
                
                // Add event listeners for install buttons
                document.querySelectorAll('.app-install-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const appId = this.dataset.appId;
                        const reward = parseInt(this.dataset.reward);
                        const url = this.dataset.url;
                        
                        installApp(appId, reward, url, this);
                    });
                });
            });
        }

        function installApp(appId, reward, url, button) {
            // Mark app as installed
            localStorage.setItem(`app_installed_${appId}`, 'true');
            
            // Award coins
            updateCoins(reward).then(() => {
                showToast(`‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶á‡¶®‡ßç‡¶∏‡¶ü‡¶≤ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ${reward} ‡¶ï‡¶Ø‡¶º‡ßá‡¶® ‡¶™‡ßÅ‡¶∞‡¶∏‡ßç‡¶ï‡¶æ‡¶∞ ‡¶™‡ßá‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡¶®!`);
                
                // Update button state
                button.disabled = true;
                button.textContent = '‡¶á‡¶®‡ßç‡¶∏‡¶ü‡¶≤‡¶°';
                
                // Open app store link
                window.open(url, '_blank');
            }).catch(err => {
                showToast('‡¶™‡ßÅ‡¶∞‡¶∏‡ßç‡¶ï‡¶æ‡¶∞ ‡¶∏‡¶Ç‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø‡•§ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
                localStorage.removeItem(`app_installed_${appId}`);
            });
        }

        // Quiz Game
        function initializeQuiz() {
            quizQuestions = [...quizData];
            loadNextQuestion();
        }

        function loadNextQuestion() {
            const questionElement = document.getElementById('quiz-question');
            const optionsElement = document.getElementById('quiz-options');
            const resultElement = document.getElementById('quiz-result');
            const nextButton = document.getElementById('next-question-btn');
            
            // Reset UI
            resultElement.textContent = '';
            nextButton.classList.add('hidden');
            optionsElement.innerHTML = '';
            
            if (currentQuestionIndex >= quizQuestions.length) {
                currentQuestionIndex = 0;
            }
            
            const currentQuestion = quizQuestions[currentQuestionIndex];
            questionElement.textContent = currentQuestion.question;
            
            currentQuestion.options.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.className = 'quiz-option';
                optionElement.textContent = option;
                optionElement.dataset.index = index;
                optionsElement.appendChild(optionElement);
            });
        }

        // Event delegation for quiz options
        document.getElementById('quiz-options').addEventListener('click', function(e) {
            if (e.target.classList.contains('quiz-option')) {
                handleAnswerSelection(e);
            }
        });

        function handleAnswerSelection(event) {
            const selectedOption = event.target;
            const selectedIndex = parseInt(selectedOption.dataset.index);
            const currentQuestion = quizQuestions[currentQuestionIndex];
            const options = document.querySelectorAll('.quiz-option');
            const resultElement = document.getElementById('quiz-result');
            const nextButton = document.getElementById('next-question-btn');
            
            // Disable all options
            options.forEach(option => {
                option.style.pointerEvents = 'none';
            });
            
            if (selectedIndex === currentQuestion.correctAnswer) {
                selectedOption.classList.add('correct');
                resultElement.textContent = '‡¶∏‡¶†‡¶ø‡¶ï ‡¶â‡¶§‡ßç‡¶§‡¶∞! ‡¶Ü‡¶™‡¶®‡¶ø 10 ‡¶ï‡¶Ø‡¶º‡ßá‡¶® ‡¶ú‡¶ø‡¶§‡ßá‡¶õ‡ßá‡¶®!';
                resultElement.style.color = 'var(--secondary-color)';
                
                // Award coins
                updateCoins(10).then(() => {
                    showToast('‡¶Ü‡¶™‡¶®‡¶ø 10 ‡¶ï‡¶Ø‡¶º‡ßá‡¶® ‡¶ú‡¶ø‡¶§‡ßá‡¶õ‡ßá‡¶®!');
                });
                
                nextButton.classList.remove('hidden');
            } else {
                selectedOption.classList.add('wrong');
                options[currentQuestion.correctAnswer].classList.add('correct');
                resultElement.textContent = '‡¶≠‡ßÅ‡¶≤ ‡¶â‡¶§‡ßç‡¶§‡¶∞! ‡¶∏‡¶†‡¶ø‡¶ï ‡¶â‡¶§‡ßç‡¶§‡¶∞‡¶ü‡¶ø ‡¶π‡¶æ‡¶á‡¶≤‡¶æ‡¶á‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§';
                resultElement.style.color = 'var(--danger-color)';
                
                // Show wrong answer popup with banner ad
                showWrongAnswerPopup();
            }
        }

        document.getElementById('next-question-btn').addEventListener('click', () => {
            currentQuestionIndex++;
            if (currentQuestionIndex >= quizQuestions.length) {
                currentQuestionIndex = 0;
            }
            loadNextQuestion();
        });
        
        // Financial Transactions
        document.getElementById('withdraw-btn').addEventListener('click', () => {
            const withdrawInput = document.getElementById('withdraw-coins');
            const withdrawMethod = document.getElementById('withdraw-method');
            const coinsToWithdraw = parseInt(withdrawInput.value);
            const method = withdrawMethod.value;
            const minWithdrawal = (appSettings.minWithdrawal || 50) * (appSettings.conversionRate || 100);
            
            if (!method) {
                showToast("‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®‡ßá‡¶∞ ‡¶™‡¶¶‡ßç‡¶ß‡¶§‡¶ø ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®‡•§");
                return;
            }
            
            if (coinsToWithdraw < minWithdrawal) {
                showToast(`‡¶∏‡¶∞‡ßç‡¶¨‡¶®‡¶ø‡¶Æ‡ßç‡¶® ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®: ${appSettings.minWithdrawal || 50} ‡¶ü‡¶æ‡¶ï‡¶æ (${minWithdrawal} ‡¶ï‡¶Ø‡¶º‡ßá‡¶®)`);
                return;
            }
            
            if (coinsToWithdraw > 0 && coinsToWithdraw <= (userData.coins || 0)) {
                updateCoins(-coinsToWithdraw).then(() => {
                    if (isFirebaseInitialized) {
                        const withdrawalRequest = {
                            userId, 
                            name: userData.name, 
                            upi: userData.upi, 
                            method: method,
                            coins: coinsToWithdraw,
                            amount: coinsToWithdraw / (appSettings.conversionRate || 100),
                            status: 'pending', 
                            timestamp: new Date().toISOString()
                        };
                        firebase.database().ref('withdrawals').push(withdrawalRequest).then(() => {
                            showToast('‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®‡ßá‡¶∞ ‡¶Ö‡¶®‡ßÅ‡¶∞‡ßã‡¶ß ‡¶ú‡¶Æ‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!');
                            withdrawInput.value = '';
                            withdrawMethod.value = '';
                            document.getElementById('withdraw-value').innerText = '0.00';
                        });
                    } else {
                        showToast('‡¶Ö‡¶´‡¶≤‡¶æ‡¶á‡¶® ‡¶Æ‡ßã‡¶°‡ßá ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶Ö‡¶®‡ßÅ‡¶∞‡ßã‡¶ß ‡¶ú‡¶Æ‡¶æ ‡¶π‡¶¨‡ßá ‡¶Ø‡¶ñ‡¶® ‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡¶®‡ßá‡¶ü ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá‡•§');
                        withdrawInput.value = '';
                        withdrawMethod.value = '';
                        document.getElementById('withdraw-value').innerText = '0.00';
                    }
                }).catch(err => showToast('‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶• ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ï‡¶Ø‡¶º‡ßá‡¶® ‡¶´‡ßá‡¶∞‡¶§ ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§'));
            } else { 
                showToast('‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ï‡¶Ø‡¶º‡ßá‡¶®‡ßá‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ ‡¶∏‡¶†‡¶ø‡¶ï ‡¶®‡¶Ø‡¶º‡•§'); 
            }
        });

        document.getElementById('deposit-btn').addEventListener('click', () => {
            const amountInput = document.getElementById('deposit-amount');
            const fileInput = document.getElementById('payment-screenshot');
            const amount = amountInput.value;
            const file = fileInput.files[0];

            if (!amount || !file) { 
                showToast("‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ ‡¶è‡¶¨‡¶Ç ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶®‡¶∂‡¶ü ‡¶¶‡¶ø‡¶®‡•§"); 
                return; 
            }
            
            if (isFirebaseInitialized) {
                const depositRequest = {
                    userId, 
                    name: userData.name, 
                    amount: parseFloat(amount),
                    screenshot_placeholder: file.name, 
                    status: 'pending', 
                    timestamp: new Date().toISOString()
                };
                firebase.database().ref('deposits').push(depositRequest).then(() => {
                    showToast('‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ú‡¶Æ‡¶æ‡¶∞ ‡¶Ö‡¶®‡ßÅ‡¶∞‡ßã‡¶ß ‡¶∞‡¶ø‡¶≠‡¶ø‡¶â‡¶Ø‡¶º‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ú‡¶Æ‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§');
                    amountInput.value = '';
                    fileInput.value = '';
                }).catch(err => showToast('‡¶ú‡¶Æ‡¶æ‡¶∞ ‡¶Ö‡¶®‡ßÅ‡¶∞‡ßã‡¶ß ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶• ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§'));
            } else {
                showToast('‡¶Ö‡¶´‡¶≤‡¶æ‡¶á‡¶® ‡¶Æ‡ßã‡¶°‡ßá ‡¶ú‡¶Æ‡¶æ‡¶∞ ‡¶Ö‡¶®‡ßÅ‡¶∞‡ßã‡¶ß ‡¶ú‡¶Æ‡¶æ ‡¶π‡¶¨‡ßá ‡¶Ø‡¶ñ‡¶® ‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡¶®‡ßá‡¶ü ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá‡•§');
                amountInput.value = '';
                fileInput.value = '';
            }
        });

        function loadTransactionHistory() {
            if (!isFirebaseInitialized || !userId) return;
            
            firebase.database().ref('withdrawals').orderByChild('userId').equalTo(userId).on('value', s => {
                const list = document.getElementById('withdrawal-history');
                list.innerHTML = '';
                s.forEach(c => {
                    const d = c.val();
                    list.innerHTML = `<li>${d.coins} ‡¶ï‡¶Ø‡¶º‡ßá‡¶® (‡ß≥${d.amount.toFixed(2)}) - ${d.status} - ${d.method}</li>` + list.innerHTML;
                });
            });
            
            firebase.database().ref('deposits').orderByChild('userId').equalTo(userId).on('value', s => {
                const list = document.getElementById('deposit-history');
                list.innerHTML = '';
                s.forEach(c => {
                    const d = c.val();
                    list.innerHTML = `<li>‡ß≥${d.amount} - ${d.status}</li>` + list.innerHTML;
                });
            });
        }
        
        // Profile and Other Features
        document.getElementById('update-profile-btn').addEventListener('click', () => {
            const newName = document.getElementById('profileName').value;
            const newUpi = document.getElementById('profileUpi').value;
            if (newName && newUpi) {
                if (isFirebaseInitialized) {
                    firebase.database().ref('users/' + userId).update({ name: newName, upi: newUpi })
                    .then(() => showToast('‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!'))
                    .catch(() => showToast('‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø‡•§'));
                } else {
                    // Update offline
                    userData.name = newName;
                    userData.upi = newUpi;
                    localStorage.setItem('userData', JSON.stringify(userData));
                    showToast('‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá! (‡¶Ö‡¶´‡¶≤‡¶æ‡¶á‡¶®)');
                }
            }
        });
        
        document.getElementById('share-whatsapp-btn').addEventListener('click', () => {
            const text = `‡¶è‡¶á ‡¶Ö‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡ßá ‡¶Ø‡ßã‡¶ó ‡¶¶‡¶ø‡¶®! ‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶ï‡ßã‡¶° ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®: ${userData.referralCode}. ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï: ${window.location.href}`;
            window.open(`https://api.whatsapp.com/send?text=${encodeURIComponent(text)}`, '_blank');
        });

        function loadPromotions() {
            if (!isFirebaseInitialized) {
                document.getElementById('promo-games-list').innerHTML = '<p>‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡¶®‡ßá‡¶ü ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶®‡ßá‡¶á‡•§ ‡¶™‡¶∞‡ßá ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</p>';
                return;
            }
            
            firebase.database().ref('promoGames').on('value', s => {
                const list = document.getElementById('promo-games-list');
                list.innerHTML = '';
                s.forEach(c => {
                    const game = c.val();
                    list.innerHTML += `<hr><p><b>${game.name}</b> (+${game.reward} ü™ô, ${game.playTime} ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü ‡¶ñ‡ßá‡¶≤‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø)</p><a href="${game.url}" target="_blank"><button class="btn btn-info">‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®</button></a>`;
                });
            });
        }

        function loadSocialTasks() {
            if (!isFirebaseInitialized) {
                document.getElementById('social-tasks-list').innerHTML = '<p>‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡¶®‡ßá‡¶ü ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶®‡ßá‡¶á‡•§ ‡¶™‡¶∞‡ßá ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</p>';
                return;
            }
            
            firebase.database().ref('socialTasks').on('value', s => {
                const list = document.getElementById('social-tasks-list');
                list.innerHTML = '';
                s.forEach(c => {
                    const task = c.val();
                    const taskId = c.key;
                    const isCompleted = localStorage.getItem('task_' + taskId);
                    list.innerHTML += `<hr><p><b>${task.name}-‡¶è ‡¶´‡¶≤‡ßã ‡¶ï‡¶∞‡ßÅ‡¶®</b> (+${task.reward} ü™ô)</p><button class="btn btn-secondary social-task-btn" data-task-id="${taskId}" data-url="${task.url}" data-reward="${task.reward}" ${isCompleted ? 'disabled' : ''}>${isCompleted ? '‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶®' : '‡¶Ø‡¶æ‡¶®'}</button>`;
                });
            });
        }

        // Event delegation for social tasks
        document.getElementById('social-tasks-list').addEventListener('click', function(e) {
            if (e.target.classList.contains('social-task-btn')) {
                completeSocialTask(e);
            }
        });

        function completeSocialTask(e) {
            const { taskId, url, reward } = e.target.dataset;
            localStorage.setItem('task_' + taskId, 'true');
            updateCoins(parseInt(reward)).then(() => {
                e.target.disabled = true;
                e.target.textContent = '‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶®';
                window.open(url, '_blank');
            }).catch(err => {
                localStorage.removeItem('task_' + taskId);
                showToast('‡¶™‡ßÅ‡¶∞‡¶∏‡ßç‡¶ï‡¶æ‡¶∞ ‡¶∏‡¶Ç‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø‡•§ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
            });
        }

        // Navigation
        const pages = document.querySelectorAll('.page');
        const navButtons = document.querySelectorAll('nav button');
        
        // Event delegation for navigation
        document.querySelector('nav').addEventListener('click', function(e) {
            if (e.target.closest('button')) {
                const button = e.target.closest('button');
                const pageId = button.dataset.page;
                
                if (pageId) {
                    pages.forEach(p => p.classList.add('hidden'));
                    document.getElementById(pageId).classList.remove('hidden');
                    navButtons.forEach(b => b.classList.remove('active'));
                    button.classList.add('active');
                }
            }
        });

        // Onboarding with unique name and phone validation
        document.getElementById('saveUser').addEventListener('click', () => {
            const name = document.getElementById('userName').value.trim();
            const upi = document.getElementById('userUpi').value.trim();

            if (name && upi) {
                // Check if user already exists with this name or phone
                const existingUsers = JSON.parse(localStorage.getItem('appUsers') || '{}');
                
                if (existingUsers[name] || existingUsers[upi]) {
                    showToast('‡¶è‡¶á ‡¶®‡¶æ‡¶Æ ‡¶¨‡¶æ ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞ ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá ‡¶á‡¶§‡¶ø‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶§‡ßà‡¶∞‡¶ø ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§');
                    return;
                }
                
                userId = 'user_' + Date.now();
                localStorage.setItem('earningAppUserId', userId);
                
                userData = {
                    name: name, 
                    upi: upi, 
                    coins: 0,
                    referralCode: Math.random().toString(36).substring(2, 8).toUpperCase(),
                    createdAt: new Date().toISOString()
                };

                // Save to localStorage immediately
                localStorage.setItem('userData', JSON.stringify(userData));
                
                // Update user index
                existingUsers[name] = userId;
                existingUsers[upi] = userId;
                localStorage.setItem('appUsers', JSON.stringify(existingUsers));
                
                if (isFirebaseInitialized) {
                    firebase.database().ref('users/' + userId).set(userData).then(() => {
                        document.getElementById('onboarding-screen').classList.add('hidden');
                        initializeApp();
                    }).catch(error => {
                        console.error("Firebase write failed: ", error);
                        showToast('‡¶§‡¶•‡ßç‡¶Ø ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø‡•§ ‡¶Ö‡¶´‡¶≤‡¶æ‡¶á‡¶® ‡¶Æ‡ßã‡¶°‡ßá ‡¶ö‡¶≤‡¶õ‡ßá‡•§');
                        document.getElementById('onboarding-screen').classList.add('hidden');
                        initializeApp();
                    });
                } else {
                    document.getElementById('onboarding-screen').classList.add('hidden');
                    initializeApp();
                }
            } else { 
                showToast('‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶∏‡¶¨ ‡¶§‡¶•‡ßç‡¶Ø ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§'); 
            }
        });

        // Global Error Handling
        window.addEventListener('error', function(e) {
            console.error('Global error:', e.error);
            showToast('‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡¶ü‡¶ø‡¶§‡ßá ‡¶∏‡¶æ‡¶Æ‡¶Ø‡¶º‡¶ø‡¶ï ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá‡•§ ‡¶™‡ßÅ‡¶®‡¶∞‡¶æ‡¶Ø‡¶º ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
        });

        window.addEventListener('unhandledrejection', function(e) {
            console.error('Unhandled promise rejection:', e.reason);
            e.preventDefault();
        });

        // Start the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize app with a small delay to ensure DOM is ready
            setTimeout(initializeApp, 100);
        });
    </script>
    <script type="text/javascript">
	atOptions = {
		'key' : '1e07401901ac4fbae023c7bd388874ed',
		'format' : 'iframe',
		'height' : 250,
		'width' : 300,
		'params' : {}
	};
</script>
	<script type='text/javascript' src='//pl26987417.effectivegatecpm.com/43/5d/62/435d62c15267ad8ac72876a00ea204bb.js'></script>
</body>
</html>
